<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Anggaran</title>
  <link rel="icon" type="png" href="ft/acc1.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container fade-in">
    <h2>Login / Register</h2>
    <form id="loginForm">
      <div class="input-group">
        <label for="username">Email</label>
        <input type="email" id="username" placeholder="Masukkan email" required>
      </div>
      
      <div class="input-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Masukkan password" required>
      </div>
      
      <button type="submit" class="btn-success">
        <span>Login</span>
      </button>
      
      <button type="button" onclick="register()" class="btn-secondary">
        <span>Register</span>
      </button>
    </form>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // üîë Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBrspKOn3db7J5rpehHu8VCGIgPdQBcLls",
      authDomain: "anggaran-rumah-tangga.firebaseapp.com",
      projectId: "anggaran-rumah-tangga",
      storageBucket: "anggaran-rumah-tangga.appspot.com",
      messagingSenderId: "681556356369",
      appId: "1:681556356369:web:6ddd11deba0033791bb0b0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // üîí Paksa simpan sesi login di LOCAL
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => {
        console.log("‚úÖ Persistence LOCAL aktif");

        // === REGISTER ===
        window.register = async function register() {
          const email = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value.trim();
          try {
            await auth.createUserWithEmailAndPassword(email, password);
            alert("‚úÖ Akun berhasil dibuat. Silakan login.");
          } catch (err) {
            alert("‚ùå " + err.message);
          }
        };

        // === LOGIN ===
        document.getElementById("loginForm").addEventListener("submit", async function(e) {
          e.preventDefault();
          const email = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value.trim();
          try {
            const userCred = await auth.signInWithEmailAndPassword(email, password);
            console.log("‚úÖ Login sukses:", userCred.user.email);
            window.location.href = "index.html";
          } catch (err) {
            console.error("‚ùå Login gagal:", err);
            alert("‚ùå " + err.message);
          }
        });
      })
      .catch(err => console.error("‚ùå Persistence error:", err));
  </script>
</body>
</html>
